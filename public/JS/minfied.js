let pageVisible,palettes={"Happy Green":{mainColor:"#69DC9E",fontColorLight:"#D3F3EE",fillColor:"#CC3363",secondaryMainColor:"#3E78B2",fontColorDark:"#20063B"}},vote=document.getElementById("vote"),dashboard=document.getElementById("dashboard"),design=document.getElementById("design"),download=document.getElementById("download"),pages={vote:{id:"vote",isSaved:!0,page:vote,method:onVoteLoad,remove:{}},design:{id:"design",isSaved:!0,page:design,method:onDesignLoad},download:{id:"downloads",isSaved:!0,page:download,method:onDownloadLoad},dashboard:{id:"dashboard",isSaved:!0,page:dashboard,method:onDashboardLoad}};function onDashboardLoad(e){}function onDownloadLoad(e){let t={Setup:{name:"Setup",url:"client.ses",element:document.getElementById("Setup")},Client:{name:"Client",url:"setup.com",element:document.getElementById("Client")}},a=copyObject(t),n=new FormPopup("changeDownload");n.setCloseable(),n.addInput({id:"name"}),n.addInput({id:"url"}),n.addButton({type:"submit",value:"Change"}),n.onSubmit(t=>{console.log(t);let l=t.settings.key;a[l].name==t.fields.name&&a[l].url==t.fields.url||setUnsaved(e),a[l].name=t.fields.name,a[l].url=t.fields.url,a[l].element.getElementsByClassName("name")[0].innerHTML=t.fields.name,a[l].element.getElementsByClassName("url")[0].innerHTML=t.fields.url,n.hide()}),getEditButtonsClick(e,e=>{console.log(a),console.log("ID",e.parentNode.id);let t=a[e.parentNode.id];n.setValue({id:"name",value:t.name}),n.setValue({id:"url",value:t.url}),n.setSetting({name:"key",value:e.parentNode.id}),n.show()}),e.onSave=function(){if(!e.isSaved){let n=new Url("dashboard/download/update",{original:t,new:a});HttpHandler.postData(n,n=>{if(n.success){for(let e in a)t[a[e].name]||(a[a[e].name]=a[e],a[a[e].name].element.id=a[e].name,delete a[e]);setSaved(e)}})}}}function getEditButtonsClick(e,t,a=!0){if(!e.hasLoaded||!a){let a=e.page.getElementsByClassName("edit");for(let e=0;e<a.length;e++)a[e].addEventListener("click",function(){t(this)},!1)}}function getRemoveButtonsClick(e,t,a=!0){if(!e.hasLoaded||!a){let a=e.page.getElementsByClassName("close");for(let e=0;e<a.length;e++)a[e].addEventListener("click",function(){t(this)},!1)}}function onDesignLoad(e){let t=e.page.getElementsByClassName("add"),a=new DOMCompiler('<div class="dropdownBtn btn noSelect" id="dropdown" data-dropdownContent="searchRankingSettings"><span>&dtrif; Happy Green</span><ul id="searchRankingSettings" class="noSelect dropdownContent"><li data-select="Happy Green">HG</li><li data-select="Deep Blue">DB</li></ul></div>').compileDOM();a=document.getElementById("dropdown");let n=new FormPopup("colorPalette");dropdownClickHandler(a,(e,t,a)=>{e.childNodes[1].innerHTML="&dtrif; "+t,n.setSetting({name:"paletteName",value:t}),n.setSetting({name:"palette",value:palettes[t]})}),dropdownClickHandler(document.getElementById("addDesignDropdown"),(e,t,a)=>{n.setSetting({name:"paletteName",value:t}),n.setSetting({name:"palette",value:palettes[t]})}),n.setCloseable(),n.appendDom(),n.addElement(a),n.addButton({type:"submit",value:"Change"}),n.onSubmit(t=>{console.log(t.settings),e.design={name:t.settings.paletteName,colors:t.settings.palette},document.body.style.setProperty("--mainColor",t.settings.palette.mainColor),document.body.style.setProperty("--secondaryMainColor",t.settings.palette.secondaryMainColor),document.body.style.setProperty("--fontColorLight",t.settings.palette.fontColorLight),document.body.style.setProperty("--fontColorDark",t.settings.palette.fontColorDark),document.body.style.setProperty("--fillColor",t.settings.palette.fillColor),setUnsaved(e),n.hide()}),e.onSave=function(e){if(!e.isSaved){if(console.log(e.design),e.design&&e.design.name&&e.design.colors){let t=new Url("dashboard/palette/update",{name:e.design.name,palette:e.design.colors});HttpHandler.postData(t,t=>{console.log(t),setSaved(e)})}if(e.choosenImage){let t=new Url("dashboard/heroImage/change",{file:e.choosenImage.getAttribute("data-name")});HttpHandler.postData(t,t=>{t.success&&(e.choosenImage=null),setSaved(e)})}}},t[0].addEventListener("click",()=>{let e=new FormPopup("addPaletteForm");e.addInput({id:"name"}),e.addInput({id:"Main color",type:"color_custom"}),e.addInput({id:"Secondary main color",type:"color_custom"}),e.addInput({id:"Font color dark",type:"color_custom"}),e.addInput({id:"Font color light",type:"color_custom"}),e.addInput({id:"Fill Color",type:"color_custom"});let t=document.getElementById("newPalettePreview");e.addElement(t),e.appendDom(),e.setCloseable(),e.addButton({type:"submit",value:"Add"}),e.onInputChange("Main color",e=>{console.log(e.value,"WOAH M8"),t.getElementsByTagName("h4")[0].style.boxShadow="inset 0 -0.2em 0 "+e.value}),e.onInputChange("Font color dark",e=>{t.getElementsByTagName("h4")[0].style.color=e.value,t.getElementsByTagName("p")[0].style.color=e.value}),e.onInputChange("Font color light",e=>{t.getElementsByClassName("popup")[0].style.color=e.value,t.getElementsByClassName("btn")[0].style.color=e.value}),e.onInputChange("Fill Color",e=>{t.getElementsByClassName("popup")[0].style.background=e.value}),e.onInputChange("Secondary main color",e=>{t.getElementsByClassName("btn")[0].style.background=e.value}),e.onSubmit(t=>{let a=new Url("dashboard/palette/add",{palette:t.fields});HttpHandler.postData(a,e=>{console.log(e)}),e.hide()}),e.show()},!1);let l=new FormPopup("HeropForm"),o=new DOMCompiler('<div id="fileHolder"> <div id="fileHolderTitle"> <h6>public/images</h6> <h3>Images</h3> </div><div class="fileWrapper"> </div></div>').compileDOM(),s=new DOMCompiler('<div class="file" data-path="{{path}}" data-name="{{name}}"> <div class="accept"> <svg id="icon-check-circle" viewBox="0 0 24 24"> <title>accept</title> <path d="M22 10.1c-0.6 0-1 0.4-1 1v0.9c0 5-4 9-9 9 0 0 0 0 0 0-5 0-9-4-9-9s4-9 9-9c0 0 0 0 0 0 1.3 0 2.5 0.3 3.7 0.8 0.5 0.2 1.1 0 1.3-0.5s0-1.1-0.5-1.3c-1.4-0.6-2.9-1-4.5-1 0 0 0 0 0 0-6.1 0-11 4.9-11 11s4.9 11 11 11c0 0 0 0 0 0 6.1 0 11-4.9 11-11v-0.9c0-0.6-0.4-1-1-1z"></path> <path d="M9.7 10.3c-0.4-0.4-1-0.4-1.4 0s-0.4 1 0 1.4l3 3c0.2 0.2 0.4 0.3 0.7 0.3s0.5-0.1 0.7-0.3l10-10c0.4-0.4 0.4-1 0-1.4s-1-0.4-1.4 0l-9.3 9.3-2.3-2.3z"></path> </svg> </div><div class="fileImage"></div><h5>{{name}}</h5> </div>'),d=o.getElementsByClassName("fileWrapper")[0],i=document.getElementById("heroImageDisplay");console.log(o),l.setCloseable(),l.addElement(o),l.addButton({value:"Change",type:"submit"});let c=new Url("dashboard/changeImage",{});console.log("hej"),l.onSubmit(()=>{console.log("wew"),i.style.background="url(../images/"+e.choosenImage.getAttribute("data-name")+")",i.style.backgroundSize="cover",i.style.backgroundPosition="50% 50%",l.hide(),d.innerHTML="",setUnsaved(e)}),getEditButtonsClick(e,t=>{console.log("edit btns"),"palette"==t.parentNode.id&&n.show(),"heroImage"==t.parentNode.id&&HttpHandler.postData(c,t=>{console.log(t),t.files.forEach(t=>{s.setVariable({variable:"path",data:"public/images/"+t.toString()}),s.setVariable({variable:"name",data:t.toString()});let a=s.compileDOM(),n=a.getElementsByClassName("fileImage")[0];n.style.background="url(../images/"+t+")",n.style.backgroundSize="cover",n.style.backgroundPosition="50% 50%",a.addEventListener("click",function(){e.choosenImage&&(e.choosenImage.getElementsByClassName("accept")[0].style.opacity="0"),this.getElementsByClassName("accept")[0].style.opacity="0.85",e.choosenImage=this},!1),d.appendChild(a)}),l.show()})},!0)}function onVoteLoad(e){let t=new FormPopup("changeVote"),a=e.page.getElementsByClassName("add")[0];if(e.added={},!isUnsaved(e)){let t={};e.originalValues=copyObject(t),e.newValues=t}let n=e.newValues,l=function(e){if(console.log(t),!t.isActive()){let a=e.parentNode.getAttribute("data-site");t.setSetting({name:"site",value:a}),t.setValue({id:"nx",value:n[a].nx}),t.setValue({id:"time",value:n[a].time}),t.setValue({id:"name",value:n[a].name}),t.setValue({id:"url",value:n[a].url}),t.show()}},o=function(t){if(console.log(t.parentNode),t.parentNode.parentNode.removeChild(t.parentNode),console.log(e.originalValues),e.added[t.parentNode.id])return n[t.parentNode.id]=null,e.originalValues[t.parentNode.id]=null,void(e.added[t.parentNode.id]=null);e.remove[t.parentNode.id]=t.parentNode.id,console.log(e.remove),setUnsaved(e)};getRemoveButtonsClick(e,o,!0),getEditButtonsClick(e,l,!0),t.addInput({id:"name"}),t.addInput({id:"nx"}),t.addInput({id:"time"}),t.addInput({id:"url"}),t.addButton({type:"submit",value:"Apply"}),t.setCloseable(),t.appendDom(),t.onSubmit(a=>{console.log(a.fields,a.settings,self);let l=n[a.settings.site];l.nx==a.fields.nx&&l.time==a.fields.time&&l.url==a.fields.url&&l.name==a.fields.name||setUnsaved(e),l.nx=parseInt(a.fields.nx),l.time=a.fields.time,l.url=a.fields.url,l.name=a.fields.name,l.element.getElementsByClassName("nx")[0].innerHTML=a.fields.nx,l.element.getElementsByClassName("time")[0].innerHTML=a.fields.time,l.element.getElementsByClassName("name")[0].innerHTML=a.fields.name,l.element.getElementsByClassName("url")[0].innerHTML=a.fields.url,t.hide()}),e.onCancelSave=function(e){},e.onSave=function(e){if(!e.isSaved){console.log(e.remove);let t=new Url("/dashboard/votes/update",{newValue:e.newValues,originalValue:e.originalValues,remove:e.remove});HttpHandler.postData(t,(t=>{console.log(t),t.success&&(e.originalValues=e.originalValues=copyObject(e.newValues),setSaved(e))}).bind(e))}};let s=new DOMCompiler('<div class="voteSite" data-site="{{name}}" id="{{name}}"> <div class="close"> <svg id="icon-pencil2" viewBox="0 0 24 24"> <title>close</title> <path d="M21 5h-4v-1c0-1.7-1.3-3-3-3h-4c-1.7 0-3 1.3-3 3v1h-4c-0.6 0-1 0.4-1 1s0.4 1 1 1h1v13c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-13h1c0.6 0 1-0.4 1-1s-0.4-1-1-1zM9 4c0-0.6 0.4-1 1-1h4c0.6 0 1 0.4 1 1v1h-6v-1zM18 20c0 0.6-0.4 1-1 1h-10c-0.6 0-1-0.4-1-1v-13h12v13z"></path> <path d="M10 10c-0.6 0-1 0.4-1 1v6c0 0.6 0.4 1 1 1s1-0.4 1-1v-6c0-0.6-0.4-1-1-1z"></path> <path d="M14 10c-0.6 0-1 0.4-1 1v6c0 0.6 0.4 1 1 1s1-0.4 1-1v-6c0-0.6-0.4-1-1-1z"></path> </svg> </div><div class="edit"><svg id="icon-pencil2" viewBox="0 0 24 24"><title>pencil2</title><path d="M21.7 7.3l-5-5c-0.4-0.4-1-0.4-1.4 0l-13 13c-0.2 0.2-0.3 0.4-0.3 0.7v5c0 0.6 0.4 1 1 1h5c0.3 0 0.5-0.1 0.7-0.3l13-13c0.4-0.4 0.4-1 0-1.4zM7.6 20h-3.6v-3.6l12-12 3.6 3.6-12 12z"></path></svg></div><h5 class="name">{{name}}</h5><h6 data-beforeContent="Nx per vote" class="nx before">{{nx}}</h6><h6 data-beforeContent="Vote interval" class="time before">{{time}}</h6><h6 data-beforeContent="Full url" class="url before">{{url}}</h6></div>'),d=document.getElementsByClassName("voteSiteHolder")[0],i=t.copy("newForm");i.setCloseable(),i.appendDom(),i.onSubmit(a=>{console.log("wew",a),s.setVariable({variable:"name",data:a.fields.name}),s.setVariable({variable:"nx",data:a.fields.nx}),s.setVariable({variable:"time",data:a.fields.time}),s.setVariable({variable:"url",data:a.fields.url});let c=s.compileDOM();d.appendChild(c),console.log(c);let r={element:c,name:a.fields.name,nx:a.fields.nx,time:a.fields.time,url:a.fields.url};n[a.fields.name]=r,e.originalValues[a.fields.name]=r,e.added[a.fields.name]=r,getEditButtonsClick(e,l,!1),getRemoveButtonsClick(e,o,!1),i.hide(),t.hide(),setUnsaved(e)}),i.addButton({type:"submit",value:"Apply"}),a.addEventListener("click",function(){t.isActive()||i.show()},!1)}function setSaveButton(e,t){t.addEventListener("click",()=>{e.onSave(e)})}function setCancelSaveButton(e,t){t.addEventListener("click",()=>{e.onCancelSave(e)})}function setUnsaved(e){e.isSaved=!1,console.log(e.page.getElementsByClassName("save")[0]),e.page.getElementsByClassName("save")[0].style.background="#3e78b2",document.getElementById(e.page.id+"_saved").style.opacity="1"}function setSaved(e){e.isSaved=!0,e.page.getElementsByClassName("save")[0].style.background="#c4c4c4",document.getElementById(e.page.id+"_saved").style.opacity="0"}function isUnsaved(e){return!e.isSaved}function copyObject(e){let t=Object.assign({},e);for(let a in t)"object"==typeof t[a]&&(t[a]=Object.assign({},e[a]));return t}function loadPage(e){pageVisible&&(pageVisible.page.style.display="none"),e.page.style.display="block",pageVisible=e,e.hasLoaded||e.method(e),e.hasLoaded=!0}setSaveButton(pages.vote,pages.vote.page.getElementsByClassName("save")[0]),setSaveButton(pages.design,pages.design.page.getElementsByClassName("save")[0]),setSaveButton(pages.download,pages.download.page.getElementsByClassName("save")[0]),loadPage(pages.dashboard);let menu=document.getElementsByClassName("categoryMenu_item");for(let e=0;e<menu.length;e++)menu[e].addEventListener("click",function(){let e=pages[this.getAttribute("data-page")];e&&loadPage(e)},!1);